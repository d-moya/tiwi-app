{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choripan-Center</title>
    <link rel="stylesheet" href="{% static 'muros/style_muro_prestamos.css' %}">
</head>

<body>
    <script>
        function cerrarmenu(){
            document.getElementById("ladomenu").style.width="0";

        }
        function abrirmenu(){
            document.getElementById("ladomenu").style.width="300px";
        } 	
    </script>

    <div class="menulado" id="ladomenu">
        <a href="javascript:void(0)" class="cerrarmenu" onclick="cerrarmenu()">X</a>

        {% if user.is_authenticated %}
            <span class= "" style="padding: 15px; display: block; color: white;">{{ user.username }}</span> 
        
            <form method="post" action="{% url 'logout' %}" style="display: block; padding: 0;">
                {% csrf_token %} <button type="submit"
                    style="background: none; border: none; color: white; cursor: pointer; 
                            width: 100%; text-align: left; padding: 10px 15px; font-size: 1em;">Cerrar Sesión </button>
            </form>
            <hr style="margin: 10px 0;">
            <a href="{% url 'home_publicar' %}">Publicar</a>
            <a href="{% url 'muro_prestamos' %}">Muro Préstamos</a>
            <a href="{% url 'muro_ayudas' %}">Muro Ayudas</a>
            <a href="{% url 'muro_servicio' %}">Muro Servicios</a>

        {% else %}
            <span style="padding: 15px; display: block; color: white;">Si quieres acceder al menu debes iniciar sesion</span> 

        {% endif %}
    </div>

    <header class="navbar"> 	 	

        <div class="logo-grupo-izquierdo">
            <a href="{% url 'home' %}" class="config-boton logo-casita">
                <img src="{% static 'images/logo-casita (2).svg' %}">
            </a>
            
            <img src="{% static 'images/logo-choripan.svg' %}">
        </div>

        <div class="Nav-Boton">
            <button class="config-boton menu-button" onclick="abrirmenu()">
                <img src="{% static 'images/logo-menu.svg' %}">
            </button>
        </div>
    </header>


    {% block content %} 
    <div class="main-content">
        <h2>Publicaciones de {{ nombre }}</h2>

        {% for pub in publicacion %}
        <div class="publicacion-card">
            <h3>
                <a href="{% url 'perfilPublico' username=pub.usuario.username %}" 
                    style="text-decoration: none; color: inherit; display: inline-flex; align-items: center;">
            
                    {% if pub.usuario.perfilusuario.fotoPerfil %}
                    <img src="{{ pub.usuario.perfilusuario.fotoPerfil.url }}" 
                         alt="Foto de {{ pub.usuario.username }}" 
                        style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;"> 
                    {% endif %}
                </a>
                <span style="vertical-align: top;">
                    {{ pub.materialPrestamo }}
                </span>
            </h3>
            <p><strong>Cantidad:</strong> {{ pub.cantMaterial }}</p>
            <p>{{ pub.contenido }}</p>
            
            {% if pub.fotoMaterial %}
                <img src="{{ pub.fotoMaterial.url }}" 
                    alt="Imagen de {{ pub.materialPrestamo }}" 
                    style="max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; border: 1px solid #444;"> 
            {% endif %}
            
            <div class="publicacion-meta"> 
                Publicado el {{ pub.fechaCreacion|date:"d M Y" }} a las {{ pub.fechaCreacion|date:"H:i" }}
            </div>

            <p style="margin-top: 15px;">
                <button onclick="verComentarios('comentarios-{{ pub.id }}')">
                    Comentarios ({{ pub.Comentarios.count }})
                </button>
            </p>
            
            <div id="comentarios-{{ pub.id }}">
                {% for comentario in pub.Comentarios.all %}
                    <p class="comentario-item"> {{ comentario.contenido }} - 
                        <a href="{% url 'perfilPublico' username=comentario.usuario.username %}" 
                            style="font-weight: bold; color: inherit; text-decoration: none; 
                            display: inline-flex; align-items: center; vertical-align: middle;">
            
                            {% if comentario.usuario.perfilusuario.fotoPerfil %}
                                <img src="{{ comentario.usuario.perfilusuario.fotoPerfil.url }}" 
                                    alt="Foto de {{ comentario.usuario.username }}" 
                                    style="width: 20px; height: 20px; border-radius: 50%; margin-right: 5px;">
                            {% endif %}
            
                            {{ comentario.usuario.username }}
                        </a>
                        ({{ comentario.fechaCreacion|date:"H:i" }})
                    </p>
                {% empty %}
                    <p style="margin-top: 10px; color: #ccc;">No hay comentarios.</p>
                {% endfor %}

                <form method="POST" action="{% url 'crear_comentario' pub.id pub.tipoMuro %}" class="comentarios-form">
                    {% csrf_token %}
                    {{ comentarios.as_p }} 
                    <button type="submit">Comentar</button>
                </form>
            </div>
            {% if pub.usuario == user %}
                <form method="POST" action="{% url 'borrarPub' pub.id %}" style="display: inline-block; margin-top: 10px;">
                    {% csrf_token %}
                    <button type="submit" style="background: #a15180;">
                        Eliminar
                    </button>
                </form>
            {% endif %}
        </div>
        {% empty %}
            <p>No hay publicaciones</p>
        {% endfor %}
    </div>

    <script>
        function verComentarios(elementId) {
            var comentariosDiv = document.getElementById(elementId);
        
        
            if (comentariosDiv.style.display === "none" || comentariosDiv.style.display === "") 
            {
                comentariosDiv.style.display = "block";
            } 
            else {
                comentariosDiv.style.display = "none";
            }
        }
    </script>
    {% endblock content %}
    </body>
</html>